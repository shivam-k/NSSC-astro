<!DOCTYPE html> 
<html>
<head>
	<title>NSSC | Astrophotography Competition</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
       <meta name="viewport" content="width=device-width, initial-scale=1">   
       <meta name="description" content="Shivam Kumar">
       <meta name="keywords" content="Homepage of nssc.in" />
       <meta name="description" content="Homepage of National Students' Space Challenge '16"/>
       <link rel="shortcut icon" type="image/png" href="nssc.png"/>
	<!--   ===================Including CSS for different screen sizes==============  -->
	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="stylesheet" media="screen and (max-width: 1550px) and (min-width: 1200px)" href="style4.css" />
	<link rel="stylesheet" media="screen and (max-width: 1200px) and (min-width: 601px)" href="style1.css" />
	<link rel="stylesheet" media="screen and (max-width: 600px) and (min-width: 351px)" href="style2.css" />
	<link rel="stylesheet" media="screen and (max-width: 350px)" href="style3.css" />
	<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-43981329-1']);
	_gaq.push(['_trackPageview']);
	(function () {
	var ga = document.createElement('script');
	ga.type = 'text/javascript';
	ga.async = true;
	ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(ga, s);
	})();
	</script>
	
	<style>
           .error {color: yellow;}
           
           #need {color: yellow;}
       </style>
       
       
</head>

<body style="background:url(back.jpg) repeat; background-size:cover;background-attachment:fixed; color: white">

<div style="background-color: rgba(0,0,0,0.6); z-index: 1">

<! ========================= Manual Checking if everything is submitted  ================================ -->


<! ============================== all about uploading entry image ============================== -->
<?php
/*** check if a file was submitted ***/
if(isset($_FILES['entry_img']))
    {
    try    {
        uploadentry();
        /*** give praise and thanks to the php gods ***/
        echo '<p>Thank you for submitting</p>';
        }
    catch(Exception $e)
        {
        echo '<h4>'.$e->getMessage().'</h4>';
        }
    }
?>

<?php
function uploadentry(){
/*** check if a file was uploaded ***/
if(is_uploaded_file($_FILES['entry_img']['tmp_name']) && getimagesize($_FILES['entry_img']['tmp_name']) != false)
    {
    /***  get the image info. ***/
    $size = getimagesize($_FILES['entry_img']['tmp_name']);
    /*** assign our variables ***/
    $type = $size['mime'];
    $imgfp = fopen($_FILES['entry_img']['tmp_name'], 'rb');
    $size = $size[3];
    $name = $_FILES['entry_img']['name'];
    $maxsize = 99999999;


    /***  check the file is less than the maximum file size ***/
    if($_FILES['entry_img']['size'] < $maxsize )
        {
        /*** connect to db ***/
        $dbh = new PDO("mysql:host=localhost;dbname=app", 'root', 'root');

                /*** set the error mode ***/
                $dbh->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

            /*** our sql query ***/
        $stmt = $dbh->prepare("INSERT INTO entry_img (image_type ,image, image_size, image_name, created) VALUES (? ,?, ?, ?, CURRENT_TIMESTAMP)");

        /*** bind the params ***/
        $stmt->bindParam(1, $type);
        $stmt->bindParam(2, $imgfp, PDO::PARAM_LOB);
        $stmt->bindParam(3, $size);
        $stmt->bindParam(4, $name);

        /*** execute the query ***/
        $stmt->execute();
        }
    else
        {
        /*** throw an exception is image is not of type ***/
        throw new Exception("File Size Error");
        }
    }
else
    {
    // if the file is not less than the maximum allowed, print an error
    throw new Exception("Unsupported Image Format!");
    }
}
?>


<!-- ===================================== all about uploading original image ================================ -->

<?php
/*** check if a file was submitted ***/
if(isset($_FILES['original_img']))
    {
    try    {
        uploadoriginal();
        /*** give praise and thanks to the php gods ***/
        echo '<p>Thank you for submitting</p>';
        }
    catch(Exception $e)
        {
        echo '<h4>'.$e->getMessage().'</h4>';
        }
    }
?>

<?php
function uploadoriginal(){
/*** check if a file was uploaded ***/
if(is_uploaded_file($_FILES['original_img']['tmp_name']) && getimagesize($_FILES['original_img']['tmp_name']) != false)
    {
    /***  get the image info. ***/
    $size = getimagesize($_FILES['original_img']['tmp_name']);
    /*** assign our variables ***/
    $type = $size['mime'];
    $imgfp = fopen($_FILES['original_img']['tmp_name'], 'rb');
    $size = $size[3];
    $name = $_FILES['original_img']['name'];
    $maxsize = 99999999;


    /***  check the file is less than the maximum file size ***/
    if($_FILES['original_img']['size'] < $maxsize )
        {
        /*** connect to db ***/
        $dbh = new PDO("mysql:host=localhost;dbname=app", 'root', 'root');

                /*** set the error mode ***/
                $dbh->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

            /*** our sql query ***/
        $stmt = $dbh->prepare("INSERT INTO original_img (image_type ,image, image_size, image_name, created) VALUES (? ,?, ?, ?, CURRENT_TIMESTAMP)");

        /*** bind the params ***/
        $stmt->bindParam(1, $type);
        $stmt->bindParam(2, $imgfp, PDO::PARAM_LOB);
        $stmt->bindParam(3, $size);
        $stmt->bindParam(4, $name);

        /*** execute the query ***/
        $stmt->execute();
        }
    else
        {
        /*** throw an exception is image is not of type ***/
        throw new Exception("File Size Error");
        }
    }
else
    {
    // if the file is not less than the maximum allowed, print an error
    throw new Exception("Unsupported Image Format!");
    }
}
?>


	<div id="envelope" style="background-color: rgba(0,0,0,0.6);">
		<header style="padding-right: 20px; padding-left: 20px">
		    <h2>Amateur Astrophotography Competition</h2>
		    <p>Under the blanket of beautiful stars, we all witness the exquisite beauty of universe which hides boundless   mysteries underneath. To provide a platform to all amateur photographers across the nation to showcase their photography skills, NSSCâ€™16 presents ASTOPHOTOGRAPHY. Winning photos will also be displayed in an exhibition in NSSC &#39;16.</p>
		</header>

		<div style= "text-align: center"><p>Fill the form below .</p></div>
		<div style="padding-right: 20px; padding-left: 20px">
		    <p style="color: yellow; ">* Required field.</p>
		</div>

		<hr>
		
		<!-- =================== entry_img submission ========================= -->
		
		<form enctype="multipart/form-data" action="<?php echo htmlentities($_SERVER['PHP_SELF']);?>" method="post" >  

		    <label><span id="need">* </span>SELECT ENTRY IMAGE :  <span style="color: yellow">(max-size: 6MB)</span></label> 
		        <span class="error"> <?php echo $entry_imgErr;?></span>
		        <input type="file" name="entry_img">
		    
		    <input type="submit" value="Send" id="submit">

		</form>
		
		<!-- =================== original_img submission ========================= -->
		
		<form enctype="multipart/form-data" action="<?php echo htmlentities($_SERVER['PHP_SELF']);?>" method="post" >  
		
		    <label><span id="need">* </span>SELECT ORIGINAL IMAGE : <span style="color: yellow">(max-size: 6MB)</span></label> 
		        <span class="error"> <?php echo $original_imgErr;?></span>
		        <input type="file" name="original_img" > 
		    
		   <input type="submit" value="Send" id="submit">

                </form>

	</div>

</div>


</body>
</html>
